{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar const_1 = require(\"../const\");\n\nvar enums_1 = require(\"../enums\");\n\nvar utils_1 = require(\"../utils\");\n\nvar ArrayUtils_1 = require(\"../Utils/ArrayUtils\");\n\nvar CellUtils_1 = require(\"../Utils/CellUtils\");\n\nvar DataUtils_1 = require(\"../Utils/DataUtils\");\n\nvar FilterUtils_1 = require(\"../Utils/FilterUtils\");\n\nvar GroupUtils_1 = require(\"../Utils/GroupUtils\");\n\nvar HeadRowUtils_1 = require(\"../Utils/HeadRowUtils\");\n\nvar NavigationUtils_1 = require(\"../Utils/NavigationUtils\");\n\nvar PropsUtils_1 = require(\"../Utils/PropsUtils\");\n\nvar addColumnsToRowEditableCells = function (editableCells, columns, rowKeyValue) {\n  var newEditableCells = __spreadArrays(editableCells);\n\n  columns.forEach(function (column) {\n    if (column.isEditable !== false && !newEditableCells.some(function (e) {\n      return e.columnKey === column.key && e.rowKeyValue === rowKeyValue;\n    })) {\n      newEditableCells.push({\n        columnKey: column.key,\n        rowKeyValue: rowKeyValue\n      });\n    }\n  });\n  return newEditableCells;\n};\n\nvar removeDataKeysFromSelectedRows = function (selectedRows, data, rowKeyField) {\n  var newSelectedRows = selectedRows.filter(function (rowKeyValue) {\n    return !data.some(function (d) {\n      return DataUtils_1.getValueByField(d, rowKeyField) === rowKeyValue;\n    });\n  });\n  return newSelectedRows;\n};\n\nvar getUpdatedFocused = function (props, action, funcToUpdate) {\n  var _a, _b;\n\n  if (!((_b = (_a = props) === null || _a === void 0 ? void 0 : _a.focused) === null || _b === void 0 ? void 0 : _b.cell)) return props;\n  var newFocused = {\n    cell: funcToUpdate(props.focused.cell, props, action.settings)\n  };\n  return __assign(__assign({}, props), {\n    focused: newFocused\n  });\n};\n\nvar kaReducer = function (props, action) {\n  var columns = props.columns,\n      _a = props.data,\n      data = _a === void 0 ? [] : _a,\n      _b = props.detailsRows,\n      detailsRows = _b === void 0 ? [] : _b,\n      _c = props.editableCells,\n      editableCells = _c === void 0 ? [] : _c,\n      groupsExpanded = props.groupsExpanded,\n      loading = props.loading,\n      paging = props.paging,\n      rowKeyField = props.rowKeyField,\n      _d = props.selectedRows,\n      selectedRows = _d === void 0 ? [] : _d,\n      validation = props.validation,\n      _e = props.sortingMode,\n      sortingMode = _e === void 0 ? enums_1.SortingMode.None : _e,\n      virtualScrolling = props.virtualScrolling;\n\n  switch (action.type) {\n    case enums_1.ActionType.MoveFocusedRight:\n      {\n        return getUpdatedFocused(props, action, NavigationUtils_1.getRightCell);\n      }\n\n    case enums_1.ActionType.MoveFocusedLeft:\n      {\n        return getUpdatedFocused(props, action, NavigationUtils_1.getLeftCell);\n      }\n\n    case enums_1.ActionType.MoveFocusedUp:\n      {\n        return getUpdatedFocused(props, action, NavigationUtils_1.getUpCell);\n      }\n\n    case enums_1.ActionType.MoveFocusedDown:\n      {\n        return getUpdatedFocused(props, action, NavigationUtils_1.getDownCell);\n      }\n\n    case enums_1.ActionType.SetFocused:\n      {\n        return __assign(__assign({}, props), {\n          focused: action.focused\n        });\n      }\n\n    case enums_1.ActionType.ClearFocused:\n      {\n        return __assign(__assign({}, props), {\n          focused: undefined\n        });\n      }\n\n    case enums_1.ActionType.ClearSingleAction:\n      {\n        return __assign(__assign({}, props), {\n          singleAction: undefined\n        });\n      }\n\n    case enums_1.ActionType.SetSingleAction:\n      {\n        return __assign(__assign({}, props), {\n          singleAction: action.singleAction\n        });\n      }\n\n    case enums_1.ActionType.ShowColumn:\n      {\n        var newColumns = __spreadArrays(columns);\n\n        var columnIndex = newColumns.findIndex(function (c) {\n          return c.key === action.columnKey;\n        });\n        newColumns[columnIndex] = __assign(__assign({}, newColumns[columnIndex]), {\n          visible: true\n        });\n        return __assign(__assign({}, props), {\n          columns: newColumns\n        });\n      }\n\n    case enums_1.ActionType.HideColumn:\n      {\n        var newColumns = __spreadArrays(columns);\n\n        var columnIndex = newColumns.findIndex(function (c) {\n          return c.key === action.columnKey;\n        });\n        newColumns[columnIndex] = __assign(__assign({}, newColumns[columnIndex]), {\n          visible: false\n        });\n        return __assign(__assign({}, props), {\n          columns: newColumns\n        });\n      }\n\n    case enums_1.ActionType.ReorderRows:\n      {\n        var newData = DataUtils_1.reorderData(data, function (d) {\n          return DataUtils_1.getValueByField(d, rowKeyField);\n        }, action.rowKeyValue, action.targetRowKeyValue);\n        return __assign(__assign({}, props), {\n          data: newData\n        });\n      }\n\n    case enums_1.ActionType.ReorderColumns:\n      {\n        var newData = DataUtils_1.reorderData(columns, function (d) {\n          return d.key;\n        }, action.columnKey, action.targetColumnKey);\n        return __assign(__assign({}, props), {\n          columns: newData\n        });\n      }\n\n    case enums_1.ActionType.ResizeColumn:\n      {\n        var columnKey_1 = action.columnKey,\n            width = action.width;\n        var column = columns.find(function (c) {\n          return c.key === columnKey_1;\n        });\n\n        var newColumn = __assign(__assign({}, column), {\n          style: __assign(__assign({}, column.style), {\n            width: width\n          })\n        });\n\n        var newColumns = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(newColumn, 'key', columns);\n        return __assign(__assign({}, props), {\n          columns: newColumns\n        });\n      }\n\n    case enums_1.ActionType.UpdatePageIndex:\n      {\n        return __assign(__assign({}, props), {\n          paging: __assign(__assign({}, paging), {\n            pageIndex: action.pageIndex\n          })\n        });\n      }\n\n    case enums_1.ActionType.UpdatePageSize:\n      {\n        return __assign(__assign({}, props), {\n          paging: __assign(__assign({}, paging), {\n            pageSize: action.pageSize\n          })\n        });\n      }\n\n    case enums_1.ActionType.UpdatePagesCount:\n      {\n        return __assign(__assign({}, props), {\n          paging: __assign(__assign({}, paging), {\n            pagesCount: action.pagesCount\n          })\n        });\n      }\n\n    case enums_1.ActionType.HideLoading:\n      {\n        return __assign(__assign({}, props), {\n          loading: __assign(__assign({}, loading), {\n            enabled: false\n          })\n        });\n      }\n\n    case enums_1.ActionType.ShowLoading:\n      {\n        var newLoading = __assign(__assign({}, loading), {\n          enabled: true\n        });\n\n        if (action.text !== undefined) {\n          newLoading.text = action.text;\n        }\n\n        return __assign(__assign({}, props), {\n          loading: newLoading\n        });\n      }\n\n    case enums_1.ActionType.ShowDetailsRow:\n      {\n        var newDetailsRows = __spreadArrays(detailsRows);\n\n        newDetailsRows.push(action.rowKeyValue);\n        return __assign(__assign({}, props), {\n          detailsRows: newDetailsRows\n        });\n      }\n\n    case enums_1.ActionType.HideDetailsRow:\n      {\n        var newDetailsRows = detailsRows.filter(function (row) {\n          return row !== action.rowKeyValue;\n        });\n        return __assign(__assign({}, props), {\n          detailsRows: newDetailsRows\n        });\n      }\n\n    case enums_1.ActionType.OpenEditor:\n      {\n        var newEditableCells = CellUtils_1.addItemToEditableCells(action, editableCells);\n        return __assign(__assign({}, props), {\n          editableCells: newEditableCells\n        });\n      }\n\n    case enums_1.ActionType.CloseEditor:\n      {\n        var newEditableCells = CellUtils_1.removeItemFromEditableCells(action, editableCells);\n        return __assign(__assign({}, props), {\n          editableCells: newEditableCells\n        });\n      }\n\n    case enums_1.ActionType.UpdateFilterRowValue:\n      {\n        var column = columns.find(function (c) {\n          return c.key === action.columnKey;\n        });\n\n        var newColumn = __assign(__assign({}, column), {\n          filterRowValue: action.filterRowValue\n        });\n\n        var newColumns = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(newColumn, 'key', columns);\n        return __assign(__assign({}, props), {\n          columns: newColumns\n        });\n      }\n\n    case enums_1.ActionType.UpdateFilterRowOperator:\n      {\n        var column = columns.find(function (c) {\n          return c.key === action.columnKey;\n        });\n\n        var newColumn = __assign(__assign({}, column), {\n          filterRowOperator: action.filterRowOperator\n        });\n\n        var newColumns = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(newColumn, 'key', columns);\n        return __assign(__assign({}, props), {\n          columns: newColumns\n        });\n      }\n\n    case enums_1.ActionType.UpdateEditorValue:\n      {\n        var newEditableCells = __spreadArrays(editableCells);\n\n        var editableCellIndex = newEditableCells.findIndex(function (c) {\n          return c.columnKey === action.columnKey && c.rowKeyValue === action.rowKeyValue;\n        });\n\n        var editableCell = __assign(__assign({}, newEditableCells[editableCellIndex]), {\n          editorValue: action.value\n        });\n\n        newEditableCells[editableCellIndex] = editableCell;\n        return __assign(__assign({}, props), {\n          editableCells: newEditableCells\n        });\n      }\n\n    case enums_1.ActionType.UpdateCellValue:\n      {\n        var row = data.find(function (d) {\n          return DataUtils_1.getValueByField(d, rowKeyField) === action.rowKeyValue;\n        });\n        var column = columns.find(function (c) {\n          return c.key === action.columnKey;\n        });\n        var updatedRowData = DataUtils_1.replaceValue(row, column, action.value);\n        var newData = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(updatedRowData, rowKeyField, data);\n        return __assign(__assign({}, props), {\n          data: newData\n        });\n      }\n\n    case enums_1.ActionType.DeleteRow:\n      {\n        var newData = data.filter(function (d) {\n          return DataUtils_1.getValueByField(d, rowKeyField) !== action.rowKeyValue;\n        });\n        return __assign(__assign({}, props), {\n          data: newData\n        });\n      }\n\n    case enums_1.ActionType.SelectAllRows:\n      {\n        var newSelectedRows = data.map(function (d) {\n          return DataUtils_1.getValueByField(d, rowKeyField);\n        });\n        return __assign(__assign({}, props), {\n          selectedRows: newSelectedRows\n        });\n      }\n\n    case enums_1.ActionType.SelectAllFilteredRows:\n      {\n        var newData = FilterUtils_1.filterAndSearchData(props);\n        var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\n        newSelectedRows = __spreadArrays(newSelectedRows, newData.map(function (d) {\n          return DataUtils_1.getValueByField(d, rowKeyField);\n        }));\n        return __assign(__assign({}, props), {\n          selectedRows: newSelectedRows\n        });\n      }\n\n    case enums_1.ActionType.SelectAllVisibleRows:\n      {\n        var newData = PropsUtils_1.getData(props);\n        var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\n        newSelectedRows = __spreadArrays(newSelectedRows, newData.map(function (d) {\n          return DataUtils_1.getValueByField(d, rowKeyField);\n        }));\n        return __assign(__assign({}, props), {\n          selectedRows: newSelectedRows\n        });\n      }\n\n    case enums_1.ActionType.Search:\n      {\n        return __assign(__assign({}, props), {\n          searchText: action.searchText\n        });\n      }\n\n    case enums_1.ActionType.SelectSingleRow:\n      {\n        var newSelectedRows = [action.rowKeyValue];\n        return __assign(__assign({}, props), {\n          selectedRows: newSelectedRows\n        });\n      }\n\n    case enums_1.ActionType.DeselectAllRows:\n      return __assign(__assign({}, props), {\n        selectedRows: []\n      });\n\n    case enums_1.ActionType.DeselectAllFilteredRows:\n      {\n        var newData = FilterUtils_1.filterAndSearchData(props);\n        var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\n        return __assign(__assign({}, props), {\n          selectedRows: newSelectedRows\n        });\n      }\n\n    case enums_1.ActionType.DeselectAllVisibleRows:\n      {\n        var newData = PropsUtils_1.getData(props);\n        var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\n        return __assign(__assign({}, props), {\n          selectedRows: newSelectedRows\n        });\n      }\n\n    case enums_1.ActionType.SelectRow:\n      return __assign(__assign({}, props), {\n        selectedRows: __spreadArrays(selectedRows, [action.rowKeyValue])\n      });\n\n    case enums_1.ActionType.SelectRowsRange:\n      {\n        var rowKeyValueTo_1 = action.rowKeyValueTo;\n\n        if (rowKeyValueTo_1) {\n          var shownData = utils_1.kaPropsUtils.getData(props);\n          var rowKeyValueToIndex = shownData.findIndex(function (d) {\n            return DataUtils_1.getValueByField(d, rowKeyField) === rowKeyValueTo_1;\n          });\n          var rowKeyValueFromIndex = shownData.findIndex(function (d) {\n            return DataUtils_1.getValueByField(d, rowKeyField) === action.rowKeyValueFrom;\n          });\n\n          if (rowKeyValueToIndex != null && rowKeyValueFromIndex != null) {\n            var _f = rowKeyValueToIndex > rowKeyValueFromIndex ? [rowKeyValueFromIndex, rowKeyValueToIndex] : [rowKeyValueToIndex, rowKeyValueFromIndex],\n                start = _f[0],\n                end = _f[1];\n\n            var rowsToSelect = [];\n\n            for (var i = start; i <= end; i++) {\n              var value = DataUtils_1.getValueByField(shownData[i], rowKeyField);\n\n              if (!selectedRows.includes(value)) {\n                rowsToSelect.push(value);\n              }\n            }\n\n            return __assign(__assign({}, props), {\n              selectedRows: __spreadArrays(selectedRows, rowsToSelect)\n            });\n          }\n        }\n\n        return __assign(__assign({}, props), {\n          selectedRows: __spreadArrays(selectedRows, [action.rowKeyValueFrom])\n        });\n      }\n\n    case enums_1.ActionType.DeselectRow:\n      {\n        var newSelectedRows = __spreadArrays(selectedRows).filter(function (s) {\n          return s !== action.rowKeyValue;\n        });\n\n        return __assign(__assign({}, props), {\n          selectedRows: newSelectedRows\n        });\n      }\n\n    case enums_1.ActionType.UpdateSortDirection:\n      var sortedColumns = HeadRowUtils_1.getUpdatedSortedColumns(columns, action.columnKey, sortingMode);\n      return __assign(__assign({}, props), {\n        columns: sortedColumns\n      });\n\n    case enums_1.ActionType.UpdateVirtualScrolling:\n      return __assign(__assign({}, props), {\n        virtualScrolling: action.virtualScrolling\n      });\n\n    case enums_1.ActionType.UpdateData:\n      return __assign(__assign({}, props), {\n        data: action.data\n      });\n\n    case enums_1.ActionType.ScrollTable:\n      if (virtualScrolling) {\n        var scrollTop = action.scrollTop;\n        return __assign(__assign({}, props), {\n          virtualScrolling: __assign(__assign({}, virtualScrolling), {\n            scrollTop: scrollTop\n          })\n        });\n      }\n\n      break;\n\n    case enums_1.ActionType.UpdateGroupsExpanded:\n      {\n        var currentGroupsExpanded = groupsExpanded;\n\n        if (!currentGroupsExpanded) {\n          var preparedOptions = PropsUtils_1.prepareTableOptions(props);\n          currentGroupsExpanded = GroupUtils_1.getExpandedGroups(preparedOptions.groupedData);\n        }\n\n        var newGroupsExpanded = GroupUtils_1.updateExpandedGroups(currentGroupsExpanded, action.groupKey);\n        return __assign(__assign({}, props), {\n          groupsExpanded: newGroupsExpanded\n        });\n      }\n\n    case enums_1.ActionType.ShowNewRow:\n    case enums_1.ActionType.OpenRowEditors:\n      {\n        var rowKeyValue = action.type === enums_1.ActionType.ShowNewRow ? const_1.newRowId : action.rowKeyValue;\n        var newEditableCells = addColumnsToRowEditableCells(editableCells, columns, rowKeyValue);\n        return __assign(__assign({}, props), {\n          editableCells: newEditableCells\n        });\n      }\n\n    case enums_1.ActionType.HideNewRow:\n    case enums_1.ActionType.CloseRowEditors:\n      {\n        var rowKeyValue_1 = action.type === enums_1.ActionType.HideNewRow ? const_1.newRowId : action.rowKeyValue;\n        var newEditableCells = editableCells.filter(function (e) {\n          return e.rowKeyValue !== rowKeyValue_1;\n        });\n        return __assign(__assign({}, props), {\n          editableCells: newEditableCells\n        });\n      }\n\n    case enums_1.ActionType.SaveRowEditors:\n    case enums_1.ActionType.SaveNewRow:\n      {\n        var isNewRow_1 = action.type === enums_1.ActionType.SaveNewRow;\n        var rowEditorKeyValue_1 = isNewRow_1 ? const_1.newRowId : action.rowKeyValue;\n        var updatedRowData_1 = data.find(function (d) {\n          return DataUtils_1.getValueByField(d, rowKeyField) === rowEditorKeyValue_1;\n        });\n        var rowEditableCells = editableCells.filter(function (editableCell) {\n          return editableCell.rowKeyValue === rowEditorKeyValue_1 && (isNewRow_1 || editableCell.hasOwnProperty('editorValue'));\n        });\n\n        if (action.validate) {\n          var validationPassed_1 = true;\n          rowEditableCells.forEach(function (cell) {\n            var column = columns.find(function (c) {\n              return c.key === cell.columnKey;\n            });\n            cell.validationMessage = validation && validation({\n              column: column,\n              value: cell.editorValue,\n              rowData: updatedRowData_1\n            });\n            validationPassed_1 = validationPassed_1 && !cell.validationMessage;\n          });\n\n          if (!validationPassed_1) {\n            return __assign(__assign({}, props), {\n              editableCells: __spreadArrays(editableCells)\n            });\n          }\n        }\n\n        var newEditableCells = editableCells.filter(function (e) {\n          return e.rowKeyValue !== rowEditorKeyValue_1;\n        });\n        rowEditableCells.forEach(function (cell) {\n          var column = columns.find(function (c) {\n            return c.key === cell.columnKey;\n          });\n          updatedRowData_1 = DataUtils_1.replaceValue(updatedRowData_1, column, cell.editorValue);\n        });\n        var newData = void 0;\n\n        if (isNewRow_1) {\n          updatedRowData_1[rowKeyField] = action.rowKeyValue;\n          newData = __spreadArrays([updatedRowData_1], data);\n        } else {\n          newData = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(updatedRowData_1, rowKeyField, data);\n        }\n\n        return __assign(__assign({}, props), {\n          data: newData,\n          editableCells: newEditableCells\n        });\n      }\n\n    case enums_1.ActionType.UpdateRow:\n      {\n        var newData = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(action.rowData, rowKeyField, data);\n        return __assign(__assign({}, props), {\n          data: newData\n        });\n      }\n  }\n\n  return props;\n};\n\nexports.kaReducer = kaReducer;","map":{"version":3,"sources":["C:/Dev76/workspace_react/board/node_modules/ka-table/Reducers/kaReducer.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__spreadArrays","il","r","Array","k","a","j","jl","defineProperty","exports","value","const_1","require","enums_1","utils_1","ArrayUtils_1","CellUtils_1","DataUtils_1","FilterUtils_1","GroupUtils_1","HeadRowUtils_1","NavigationUtils_1","PropsUtils_1","addColumnsToRowEditableCells","editableCells","columns","rowKeyValue","newEditableCells","forEach","column","isEditable","some","e","columnKey","key","push","removeDataKeysFromSelectedRows","selectedRows","data","rowKeyField","newSelectedRows","filter","d","getValueByField","getUpdatedFocused","props","action","funcToUpdate","_a","_b","focused","cell","newFocused","settings","kaReducer","detailsRows","_c","groupsExpanded","loading","paging","_d","validation","_e","sortingMode","SortingMode","None","virtualScrolling","type","ActionType","MoveFocusedRight","getRightCell","MoveFocusedLeft","getLeftCell","MoveFocusedUp","getUpCell","MoveFocusedDown","getDownCell","SetFocused","ClearFocused","undefined","ClearSingleAction","singleAction","SetSingleAction","ShowColumn","newColumns","columnIndex","findIndex","c","visible","HideColumn","ReorderRows","newData","reorderData","targetRowKeyValue","ReorderColumns","targetColumnKey","ResizeColumn","columnKey_1","width","find","newColumn","style","getCopyOfArrayAndInsertOrReplaceItem","UpdatePageIndex","pageIndex","UpdatePageSize","pageSize","UpdatePagesCount","pagesCount","HideLoading","enabled","ShowLoading","newLoading","text","ShowDetailsRow","newDetailsRows","HideDetailsRow","row","OpenEditor","addItemToEditableCells","CloseEditor","removeItemFromEditableCells","UpdateFilterRowValue","filterRowValue","UpdateFilterRowOperator","filterRowOperator","UpdateEditorValue","editableCellIndex","editableCell","editorValue","UpdateCellValue","updatedRowData","replaceValue","DeleteRow","SelectAllRows","map","SelectAllFilteredRows","filterAndSearchData","SelectAllVisibleRows","getData","Search","searchText","SelectSingleRow","DeselectAllRows","DeselectAllFilteredRows","DeselectAllVisibleRows","SelectRow","SelectRowsRange","rowKeyValueTo_1","rowKeyValueTo","shownData","kaPropsUtils","rowKeyValueToIndex","rowKeyValueFromIndex","rowKeyValueFrom","_f","start","end","rowsToSelect","includes","DeselectRow","UpdateSortDirection","sortedColumns","getUpdatedSortedColumns","UpdateVirtualScrolling","UpdateData","ScrollTable","scrollTop","UpdateGroupsExpanded","currentGroupsExpanded","preparedOptions","prepareTableOptions","getExpandedGroups","groupedData","newGroupsExpanded","updateExpandedGroups","groupKey","ShowNewRow","OpenRowEditors","newRowId","HideNewRow","CloseRowEditors","rowKeyValue_1","SaveRowEditors","SaveNewRow","isNewRow_1","rowEditorKeyValue_1","updatedRowData_1","rowEditableCells","validate","validationPassed_1","validationMessage","rowData","UpdateRow"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar const_1 = require(\"../const\");\r\nvar enums_1 = require(\"../enums\");\r\nvar utils_1 = require(\"../utils\");\r\nvar ArrayUtils_1 = require(\"../Utils/ArrayUtils\");\r\nvar CellUtils_1 = require(\"../Utils/CellUtils\");\r\nvar DataUtils_1 = require(\"../Utils/DataUtils\");\r\nvar FilterUtils_1 = require(\"../Utils/FilterUtils\");\r\nvar GroupUtils_1 = require(\"../Utils/GroupUtils\");\r\nvar HeadRowUtils_1 = require(\"../Utils/HeadRowUtils\");\r\nvar NavigationUtils_1 = require(\"../Utils/NavigationUtils\");\r\nvar PropsUtils_1 = require(\"../Utils/PropsUtils\");\r\nvar addColumnsToRowEditableCells = function (editableCells, columns, rowKeyValue) {\r\n    var newEditableCells = __spreadArrays(editableCells);\r\n    columns.forEach(function (column) {\r\n        if (column.isEditable !== false\r\n            && !newEditableCells.some(function (e) { return e.columnKey === column.key && e.rowKeyValue === rowKeyValue; })) {\r\n            newEditableCells.push({\r\n                columnKey: column.key,\r\n                rowKeyValue: rowKeyValue\r\n            });\r\n        }\r\n    });\r\n    return newEditableCells;\r\n};\r\nvar removeDataKeysFromSelectedRows = function (selectedRows, data, rowKeyField) {\r\n    var newSelectedRows = selectedRows.filter(function (rowKeyValue) {\r\n        return !data.some(function (d) { return DataUtils_1.getValueByField(d, rowKeyField) === rowKeyValue; });\r\n    });\r\n    return newSelectedRows;\r\n};\r\nvar getUpdatedFocused = function (props, action, funcToUpdate) {\r\n    var _a, _b;\r\n    if (!((_b = (_a = props) === null || _a === void 0 ? void 0 : _a.focused) === null || _b === void 0 ? void 0 : _b.cell))\r\n        return props;\r\n    var newFocused = { cell: funcToUpdate(props.focused.cell, props, action.settings) };\r\n    return __assign(__assign({}, props), { focused: newFocused });\r\n};\r\nvar kaReducer = function (props, action) {\r\n    var columns = props.columns, _a = props.data, data = _a === void 0 ? [] : _a, _b = props.detailsRows, detailsRows = _b === void 0 ? [] : _b, _c = props.editableCells, editableCells = _c === void 0 ? [] : _c, groupsExpanded = props.groupsExpanded, loading = props.loading, paging = props.paging, rowKeyField = props.rowKeyField, _d = props.selectedRows, selectedRows = _d === void 0 ? [] : _d, validation = props.validation, _e = props.sortingMode, sortingMode = _e === void 0 ? enums_1.SortingMode.None : _e, virtualScrolling = props.virtualScrolling;\r\n    switch (action.type) {\r\n        case enums_1.ActionType.MoveFocusedRight: {\r\n            return getUpdatedFocused(props, action, NavigationUtils_1.getRightCell);\r\n        }\r\n        case enums_1.ActionType.MoveFocusedLeft: {\r\n            return getUpdatedFocused(props, action, NavigationUtils_1.getLeftCell);\r\n        }\r\n        case enums_1.ActionType.MoveFocusedUp: {\r\n            return getUpdatedFocused(props, action, NavigationUtils_1.getUpCell);\r\n        }\r\n        case enums_1.ActionType.MoveFocusedDown: {\r\n            return getUpdatedFocused(props, action, NavigationUtils_1.getDownCell);\r\n        }\r\n        case enums_1.ActionType.SetFocused: {\r\n            return __assign(__assign({}, props), { focused: action.focused });\r\n        }\r\n        case enums_1.ActionType.ClearFocused: {\r\n            return __assign(__assign({}, props), { focused: undefined });\r\n        }\r\n        case enums_1.ActionType.ClearSingleAction: {\r\n            return __assign(__assign({}, props), { singleAction: undefined });\r\n        }\r\n        case enums_1.ActionType.SetSingleAction: {\r\n            return __assign(__assign({}, props), { singleAction: action.singleAction });\r\n        }\r\n        case enums_1.ActionType.ShowColumn: {\r\n            var newColumns = __spreadArrays(columns);\r\n            var columnIndex = newColumns.findIndex(function (c) { return c.key === action.columnKey; });\r\n            newColumns[columnIndex] = __assign(__assign({}, newColumns[columnIndex]), { visible: true });\r\n            return __assign(__assign({}, props), { columns: newColumns });\r\n        }\r\n        case enums_1.ActionType.HideColumn: {\r\n            var newColumns = __spreadArrays(columns);\r\n            var columnIndex = newColumns.findIndex(function (c) { return c.key === action.columnKey; });\r\n            newColumns[columnIndex] = __assign(__assign({}, newColumns[columnIndex]), { visible: false });\r\n            return __assign(__assign({}, props), { columns: newColumns });\r\n        }\r\n        case enums_1.ActionType.ReorderRows: {\r\n            var newData = DataUtils_1.reorderData(data, function (d) { return DataUtils_1.getValueByField(d, rowKeyField); }, action.rowKeyValue, action.targetRowKeyValue);\r\n            return __assign(__assign({}, props), { data: newData });\r\n        }\r\n        case enums_1.ActionType.ReorderColumns: {\r\n            var newData = DataUtils_1.reorderData(columns, function (d) { return d.key; }, action.columnKey, action.targetColumnKey);\r\n            return __assign(__assign({}, props), { columns: newData });\r\n        }\r\n        case enums_1.ActionType.ResizeColumn: {\r\n            var columnKey_1 = action.columnKey, width = action.width;\r\n            var column = columns.find(function (c) { return c.key === columnKey_1; });\r\n            var newColumn = __assign(__assign({}, column), { style: __assign(__assign({}, column.style), { width: width }) });\r\n            var newColumns = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(newColumn, 'key', columns);\r\n            return __assign(__assign({}, props), { columns: newColumns });\r\n        }\r\n        case enums_1.ActionType.UpdatePageIndex: {\r\n            return __assign(__assign({}, props), { paging: __assign(__assign({}, paging), { pageIndex: action.pageIndex }) });\r\n        }\r\n        case enums_1.ActionType.UpdatePageSize: {\r\n            return __assign(__assign({}, props), { paging: __assign(__assign({}, paging), { pageSize: action.pageSize }) });\r\n        }\r\n        case enums_1.ActionType.UpdatePagesCount: {\r\n            return __assign(__assign({}, props), { paging: __assign(__assign({}, paging), { pagesCount: action.pagesCount }) });\r\n        }\r\n        case enums_1.ActionType.HideLoading: {\r\n            return __assign(__assign({}, props), { loading: __assign(__assign({}, loading), { enabled: false }) });\r\n        }\r\n        case enums_1.ActionType.ShowLoading: {\r\n            var newLoading = __assign(__assign({}, loading), { enabled: true });\r\n            if (action.text !== undefined) {\r\n                newLoading.text = action.text;\r\n            }\r\n            return __assign(__assign({}, props), { loading: newLoading });\r\n        }\r\n        case enums_1.ActionType.ShowDetailsRow: {\r\n            var newDetailsRows = __spreadArrays(detailsRows);\r\n            newDetailsRows.push(action.rowKeyValue);\r\n            return __assign(__assign({}, props), { detailsRows: newDetailsRows });\r\n        }\r\n        case enums_1.ActionType.HideDetailsRow: {\r\n            var newDetailsRows = detailsRows.filter(function (row) { return row !== action.rowKeyValue; });\r\n            return __assign(__assign({}, props), { detailsRows: newDetailsRows });\r\n        }\r\n        case enums_1.ActionType.OpenEditor: {\r\n            var newEditableCells = CellUtils_1.addItemToEditableCells(action, editableCells);\r\n            return __assign(__assign({}, props), { editableCells: newEditableCells });\r\n        }\r\n        case enums_1.ActionType.CloseEditor: {\r\n            var newEditableCells = CellUtils_1.removeItemFromEditableCells(action, editableCells);\r\n            return __assign(__assign({}, props), { editableCells: newEditableCells });\r\n        }\r\n        case enums_1.ActionType.UpdateFilterRowValue: {\r\n            var column = columns.find(function (c) { return c.key === action.columnKey; });\r\n            var newColumn = __assign(__assign({}, column), { filterRowValue: action.filterRowValue });\r\n            var newColumns = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(newColumn, 'key', columns);\r\n            return __assign(__assign({}, props), { columns: newColumns });\r\n        }\r\n        case enums_1.ActionType.UpdateFilterRowOperator: {\r\n            var column = columns.find(function (c) { return c.key === action.columnKey; });\r\n            var newColumn = __assign(__assign({}, column), { filterRowOperator: action.filterRowOperator });\r\n            var newColumns = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(newColumn, 'key', columns);\r\n            return __assign(__assign({}, props), { columns: newColumns });\r\n        }\r\n        case enums_1.ActionType.UpdateEditorValue: {\r\n            var newEditableCells = __spreadArrays(editableCells);\r\n            var editableCellIndex = newEditableCells.findIndex(function (c) { return c.columnKey === action.columnKey && c.rowKeyValue === action.rowKeyValue; });\r\n            var editableCell = __assign(__assign({}, newEditableCells[editableCellIndex]), { editorValue: action.value });\r\n            newEditableCells[editableCellIndex] = editableCell;\r\n            return __assign(__assign({}, props), { editableCells: newEditableCells });\r\n        }\r\n        case enums_1.ActionType.UpdateCellValue: {\r\n            var row = data.find(function (d) { return DataUtils_1.getValueByField(d, rowKeyField) === action.rowKeyValue; });\r\n            var column = columns.find(function (c) { return c.key === action.columnKey; });\r\n            var updatedRowData = DataUtils_1.replaceValue(row, column, action.value);\r\n            var newData = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(updatedRowData, rowKeyField, data);\r\n            return __assign(__assign({}, props), { data: newData });\r\n        }\r\n        case enums_1.ActionType.DeleteRow: {\r\n            var newData = data.filter(function (d) { return DataUtils_1.getValueByField(d, rowKeyField) !== action.rowKeyValue; });\r\n            return __assign(__assign({}, props), { data: newData });\r\n        }\r\n        case enums_1.ActionType.SelectAllRows: {\r\n            var newSelectedRows = data.map(function (d) { return DataUtils_1.getValueByField(d, rowKeyField); });\r\n            return __assign(__assign({}, props), { selectedRows: newSelectedRows });\r\n        }\r\n        case enums_1.ActionType.SelectAllFilteredRows: {\r\n            var newData = FilterUtils_1.filterAndSearchData(props);\r\n            var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\r\n            newSelectedRows = __spreadArrays(newSelectedRows, newData.map(function (d) { return DataUtils_1.getValueByField(d, rowKeyField); }));\r\n            return __assign(__assign({}, props), { selectedRows: newSelectedRows });\r\n        }\r\n        case enums_1.ActionType.SelectAllVisibleRows: {\r\n            var newData = PropsUtils_1.getData(props);\r\n            var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\r\n            newSelectedRows = __spreadArrays(newSelectedRows, newData.map(function (d) { return DataUtils_1.getValueByField(d, rowKeyField); }));\r\n            return __assign(__assign({}, props), { selectedRows: newSelectedRows });\r\n        }\r\n        case enums_1.ActionType.Search: {\r\n            return __assign(__assign({}, props), { searchText: action.searchText });\r\n        }\r\n        case enums_1.ActionType.SelectSingleRow: {\r\n            var newSelectedRows = [action.rowKeyValue];\r\n            return __assign(__assign({}, props), { selectedRows: newSelectedRows });\r\n        }\r\n        case enums_1.ActionType.DeselectAllRows:\r\n            return __assign(__assign({}, props), { selectedRows: [] });\r\n        case enums_1.ActionType.DeselectAllFilteredRows: {\r\n            var newData = FilterUtils_1.filterAndSearchData(props);\r\n            var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\r\n            return __assign(__assign({}, props), { selectedRows: newSelectedRows });\r\n        }\r\n        case enums_1.ActionType.DeselectAllVisibleRows: {\r\n            var newData = PropsUtils_1.getData(props);\r\n            var newSelectedRows = removeDataKeysFromSelectedRows(selectedRows, newData, rowKeyField);\r\n            return __assign(__assign({}, props), { selectedRows: newSelectedRows });\r\n        }\r\n        case enums_1.ActionType.SelectRow:\r\n            return __assign(__assign({}, props), { selectedRows: __spreadArrays(selectedRows, [action.rowKeyValue]) });\r\n        case enums_1.ActionType.SelectRowsRange: {\r\n            var rowKeyValueTo_1 = action.rowKeyValueTo;\r\n            if (rowKeyValueTo_1) {\r\n                var shownData = utils_1.kaPropsUtils.getData(props);\r\n                var rowKeyValueToIndex = shownData.findIndex(function (d) { return DataUtils_1.getValueByField(d, rowKeyField) === rowKeyValueTo_1; });\r\n                var rowKeyValueFromIndex = shownData.findIndex(function (d) { return DataUtils_1.getValueByField(d, rowKeyField) === action.rowKeyValueFrom; });\r\n                if (rowKeyValueToIndex != null && rowKeyValueFromIndex != null) {\r\n                    var _f = rowKeyValueToIndex > rowKeyValueFromIndex ? [rowKeyValueFromIndex, rowKeyValueToIndex] : [rowKeyValueToIndex, rowKeyValueFromIndex], start = _f[0], end = _f[1];\r\n                    var rowsToSelect = [];\r\n                    for (var i = start; i <= end; i++) {\r\n                        var value = DataUtils_1.getValueByField(shownData[i], rowKeyField);\r\n                        if (!selectedRows.includes(value)) {\r\n                            rowsToSelect.push(value);\r\n                        }\r\n                    }\r\n                    return __assign(__assign({}, props), { selectedRows: __spreadArrays(selectedRows, rowsToSelect) });\r\n                }\r\n            }\r\n            return __assign(__assign({}, props), { selectedRows: __spreadArrays(selectedRows, [action.rowKeyValueFrom]) });\r\n        }\r\n        case enums_1.ActionType.DeselectRow: {\r\n            var newSelectedRows = __spreadArrays(selectedRows).filter(function (s) { return s !== action.rowKeyValue; });\r\n            return __assign(__assign({}, props), { selectedRows: newSelectedRows });\r\n        }\r\n        case enums_1.ActionType.UpdateSortDirection:\r\n            var sortedColumns = HeadRowUtils_1.getUpdatedSortedColumns(columns, action.columnKey, sortingMode);\r\n            return __assign(__assign({}, props), { columns: sortedColumns });\r\n        case enums_1.ActionType.UpdateVirtualScrolling:\r\n            return __assign(__assign({}, props), { virtualScrolling: action.virtualScrolling });\r\n        case enums_1.ActionType.UpdateData:\r\n            return __assign(__assign({}, props), { data: action.data });\r\n        case enums_1.ActionType.ScrollTable:\r\n            if (virtualScrolling) {\r\n                var scrollTop = action.scrollTop;\r\n                return __assign(__assign({}, props), { virtualScrolling: __assign(__assign({}, virtualScrolling), { scrollTop: scrollTop }) });\r\n            }\r\n            break;\r\n        case enums_1.ActionType.UpdateGroupsExpanded: {\r\n            var currentGroupsExpanded = groupsExpanded;\r\n            if (!currentGroupsExpanded) {\r\n                var preparedOptions = PropsUtils_1.prepareTableOptions(props);\r\n                currentGroupsExpanded = GroupUtils_1.getExpandedGroups(preparedOptions.groupedData);\r\n            }\r\n            var newGroupsExpanded = GroupUtils_1.updateExpandedGroups(currentGroupsExpanded, action.groupKey);\r\n            return __assign(__assign({}, props), { groupsExpanded: newGroupsExpanded });\r\n        }\r\n        case enums_1.ActionType.ShowNewRow:\r\n        case enums_1.ActionType.OpenRowEditors: {\r\n            var rowKeyValue = action.type === enums_1.ActionType.ShowNewRow ? const_1.newRowId : action.rowKeyValue;\r\n            var newEditableCells = addColumnsToRowEditableCells(editableCells, columns, rowKeyValue);\r\n            return __assign(__assign({}, props), { editableCells: newEditableCells });\r\n        }\r\n        case enums_1.ActionType.HideNewRow:\r\n        case enums_1.ActionType.CloseRowEditors: {\r\n            var rowKeyValue_1 = action.type === enums_1.ActionType.HideNewRow ? const_1.newRowId : action.rowKeyValue;\r\n            var newEditableCells = editableCells.filter(function (e) { return e.rowKeyValue !== rowKeyValue_1; });\r\n            return __assign(__assign({}, props), { editableCells: newEditableCells });\r\n        }\r\n        case enums_1.ActionType.SaveRowEditors:\r\n        case enums_1.ActionType.SaveNewRow: {\r\n            var isNewRow_1 = action.type === enums_1.ActionType.SaveNewRow;\r\n            var rowEditorKeyValue_1 = isNewRow_1 ? const_1.newRowId : action.rowKeyValue;\r\n            var updatedRowData_1 = data.find(function (d) { return DataUtils_1.getValueByField(d, rowKeyField) === rowEditorKeyValue_1; });\r\n            var rowEditableCells = editableCells.filter(function (editableCell) { return editableCell.rowKeyValue === rowEditorKeyValue_1\r\n                && (isNewRow_1 || editableCell.hasOwnProperty('editorValue')); });\r\n            if (action.validate) {\r\n                var validationPassed_1 = true;\r\n                rowEditableCells.forEach(function (cell) {\r\n                    var column = columns.find(function (c) { return c.key === cell.columnKey; });\r\n                    cell.validationMessage = validation && validation({\r\n                        column: column,\r\n                        value: cell.editorValue,\r\n                        rowData: updatedRowData_1\r\n                    });\r\n                    validationPassed_1 = validationPassed_1 && !cell.validationMessage;\r\n                });\r\n                if (!validationPassed_1) {\r\n                    return __assign(__assign({}, props), { editableCells: __spreadArrays(editableCells) });\r\n                }\r\n            }\r\n            var newEditableCells = editableCells.filter(function (e) { return e.rowKeyValue !== rowEditorKeyValue_1; });\r\n            rowEditableCells.forEach(function (cell) {\r\n                var column = columns.find(function (c) { return c.key === cell.columnKey; });\r\n                updatedRowData_1 = DataUtils_1.replaceValue(updatedRowData_1, column, cell.editorValue);\r\n            });\r\n            var newData = void 0;\r\n            if (isNewRow_1) {\r\n                updatedRowData_1[rowKeyField] = action.rowKeyValue;\r\n                newData = __spreadArrays([updatedRowData_1], data);\r\n            }\r\n            else {\r\n                newData = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(updatedRowData_1, rowKeyField, data);\r\n            }\r\n            return __assign(__assign({}, props), { data: newData, editableCells: newEditableCells });\r\n        }\r\n        case enums_1.ActionType.UpdateRow: {\r\n            var newData = ArrayUtils_1.getCopyOfArrayAndInsertOrReplaceItem(action.rowData, rowKeyField, data);\r\n            return __assign(__assign({}, props), { data: newData });\r\n        }\r\n    }\r\n    return props;\r\n};\r\nexports.kaReducer = kaReducer;\r\n"]},"metadata":{},"sourceType":"script"}